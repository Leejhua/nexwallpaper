<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ° Labubué«˜æ¸…å£çº¸ç”»å»Š - 400+ç²¾é€‰æ”¶è—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            margin: 0;
            display: flex;
        }

        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-250px);
        }

        .sidebar-toggle {
            position: fixed;
            left: 260px;
            top: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 18px;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .sidebar.collapsed + .sidebar-toggle {
            left: 10px;
        }

        .sidebar-toggle:hover {
            transform: scale(1.1);
        }

        .main-content {
            flex: 1;
            margin-left: 300px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 50px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .title {
            text-align: center;
            margin-bottom: 0;
        }

        .title h1 {
            font-size: 2rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }

        .title p {
            margin: 5px 0 0 0;
            font-size: 0.9rem;
            color: #666;
        }

        .sidebar-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .sidebar-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .sidebar-section h3 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px;
            border-radius: 15px;
            font-weight: bold;
            text-align: center;
            font-size: 0.85rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-btn, .view-btn, .page-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            text-align: left;
        }

        .filter-btn:hover, .view-btn:hover, .page-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .filter-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .pagination-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .page-size-selector {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .page-size-selector label {
            font-weight: bold;
            color: #333;
        }

        .page-size-selector select {
            padding: 10px 12px;
            border-radius: 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            background: rgba(255,255,255,0.9);
            font-weight: bold;
        }

        .page-navigation {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .page-info {
            background: rgba(255,255,255,0.9);
            padding: 8px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85rem;
            text-align: center;
            flex: 1;
        }

        .gallery {
            padding: 20px;
        }

        .masonry-container {
            column-count: 4;
            column-gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .gallery-item {
            break-inside: avoid;
            margin-bottom: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
        }

        .gallery-item img, .gallery-item video {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.3s ease;
        }

        .gallery-item:hover img, .gallery-item:hover video {
            transform: scale(1.05);
        }

        .item-info {
            padding: 15px;
            background: white;
        }

        .item-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
        }

        .tag.fantasy { background: linear-gradient(45deg, #667eea, #764ba2); }
        .tag.desktop { background: linear-gradient(45deg, #f093fb, #f5576c); }
        .tag.mobile { background: linear-gradient(45deg, #4facfe, #00f2fe); }
        .tag.seasonal { background: linear-gradient(45deg, #43e97b, #38f9d7); }
        .tag.live { background: linear-gradient(45deg, #fa709a, #fee140); }
        .tag.k4 { background: linear-gradient(45deg, #a8edea, #fed6e3); color: #333; }

        .video-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .loading-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-weight: bold;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 90%;
            max-width: 1200px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .modal img, .modal video {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .modal-info {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
            max-width: 600px;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 2001;
        }

        .close:hover {
            color: #ccc;
        }

        .download-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .masonry-container { column-count: 3; }
            .sidebar { width: 280px; }
            .main-content { margin-left: 280px; }
            .sidebar-toggle { left: 240px; }
            .sidebar.collapsed + .sidebar-toggle { left: 10px; }
        }

        @media (max-width: 768px) {
            .masonry-container { column-count: 2; }
            .title h1 { font-size: 1.8rem; }
            .sidebar { width: 100%; transform: translateX(-100%); }
            .sidebar.show { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .main-content.expanded { margin-left: 0; }
            .sidebar-toggle { left: 10px; }
            .stats { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .masonry-container { column-count: 1; }
            .gallery { padding: 15px; }
            .header { padding: 10px 15px; }
            .sidebar { padding: 15px; }
        }

        .hidden {
            display: none;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2rem;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="title">
                <h1>ğŸ° Labubué«˜æ¸…å£çº¸ç”»å»Š</h1>
                <p>ç²¾é€‰400+é«˜æ¸…å£çº¸ Â· çœŸæ­£çš„4Kç”»è´¨ä½“éªŒ</p>
            </div>
            
            <div class="stats">
                <div class="stat-item">ğŸ“¸ <span id="imageCount">386</span> å¼ å›¾ç‰‡</div>
                <div class="stat-item">ğŸ¬ <span id="videoCount">14</span> ä¸ªè§†é¢‘</div>
                <div class="stat-item">ğŸ¨ <span id="totalCount">400</span> ä¸ªä½œå“</div>
                <div class="stat-item">âœ¨ çœŸæ­£é«˜æ¸…</div>
            </div>

            <div class="controls">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="fantasy">å¥‡å¹»</button>
                <button class="filter-btn" data-filter="desktop">æ¡Œé¢</button>
                <button class="filter-btn" data-filter="mobile">æ‰‹æœº</button>
                <button class="filter-btn" data-filter="seasonal">å­£èŠ‚</button>
                <button class="filter-btn" data-filter="4k">4K</button>
                <button class="filter-btn" data-filter="live">åŠ¨æ€</button>
            </div>

            <div class="pagination-controls">
                <div class="page-size-selector">
                    <label>æ¯é¡µæ˜¾ç¤º:</label>
                    <select id="pageSizeSelect">
                        <option value="24">24ä¸ª</option>
                        <option value="36" selected>36ä¸ª</option>
                        <option value="48">48ä¸ª</option>
                        <option value="60">60ä¸ª</option>
                    </select>
                </div>
                <button class="page-btn" id="prevBtn">â† ä¸Šä¸€é¡µ</button>
                <div class="page-info">
                    ç¬¬ <span id="currentPage">1</span> é¡µ / å…± <span id="totalPages">1</span> é¡µ
                </div>
                <button class="page-btn" id="nextBtn">ä¸‹ä¸€é¡µ â†’</button>
            </div>
        </div>
    </div>

    <div class="gallery">
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            æ­£åœ¨åŠ è½½é«˜æ¸…å£çº¸...
        </div>
        <div class="masonry-container" id="galleryContainer"></div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img id="modalImage" src="" alt="">
            <video id="modalVideo" controls style="display: none;"></video>
            <div class="modal-info">
                <h3 id="modalTitle"></h3>
                <div id="modalTags"></div>
                <button class="download-btn" id="downloadBtn">ä¸‹è½½é«˜æ¸…åŸå›¾</button>
            </div>
        </div>
    </div>

    <script src="hd_gallery_data.js"></script>
    <script>
        class HDLabubuGallery {
            constructor() {
                this.allItems = hdImageData || [];
                this.filteredItems = [...this.allItems];
                this.currentFilter = 'all';
                this.currentPage = 1;
                this.pageSize = 36;
                this.totalPages = 1;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateStats();
                this.filterItems('all');
                this.hideLoading();
            }

            setupEventListeners() {
                // ç­›é€‰æŒ‰é’®
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filter = e.target.dataset.filter;
                        this.filterItems(filter);
                    });
                });

                // åˆ†é¡µæ§åˆ¶
                document.getElementById('prevBtn').addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.renderGallery();
                    }
                });

                document.getElementById('nextBtn').addEventListener('click', () => {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                        this.renderGallery();
                    }
                });

                // é¡µé¢å¤§å°é€‰æ‹©
                document.getElementById('pageSizeSelect').addEventListener('change', (e) => {
                    this.pageSize = parseInt(e.target.value);
                    this.currentPage = 1;
                    this.renderGallery();
                });

                // æ¨¡æ€æ¡†
                const modal = document.getElementById('imageModal');
                const closeBtn = document.querySelector('.close');
                
                closeBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                    this.pauseModalVideo();
                });

                window.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                        this.pauseModalVideo();
                    }
                });

                // é”®ç›˜å¯¼èˆª
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        modal.style.display = 'none';
                        this.pauseModalVideo();
                    } else if (e.key === 'ArrowLeft' && this.currentPage > 1) {
                        this.currentPage--;
                        this.renderGallery();
                    } else if (e.key === 'ArrowRight' && this.currentPage < this.totalPages) {
                        this.currentPage++;
                        this.renderGallery();
                    }
                });
            }

            updateStats() {
                const imageCount = this.allItems.filter(item => item.type === 'image').length;
                const videoCount = this.allItems.filter(item => item.type === 'video').length;
                
                document.getElementById('imageCount').textContent = imageCount;
                document.getElementById('videoCount').textContent = videoCount;
                document.getElementById('totalCount').textContent = this.allItems.length;
            }

            filterItems(filter) {
                this.currentFilter = filter;
                this.currentPage = 1;

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

                // ç­›é€‰æ•°æ®
                if (filter === 'all') {
                    this.filteredItems = [...this.allItems];
                } else if (filter === 'live') {
                    this.filteredItems = this.allItems.filter(item => item.type === 'video');
                } else if (filter === '4k') {
                    this.filteredItems = this.allItems.filter(item => 
                        item.category === '4k' || item.resolution === '4K'
                    );
                } else {
                    this.filteredItems = this.allItems.filter(item => 
                        item.category === filter
                    );
                }

                this.renderGallery();
            }

            renderGallery() {
                const container = document.getElementById('galleryContainer');
                
                // è®¡ç®—åˆ†é¡µ
                this.totalPages = Math.ceil(this.filteredItems.length / this.pageSize);
                const startIndex = (this.currentPage - 1) * this.pageSize;
                const endIndex = startIndex + this.pageSize;
                const currentItems = this.filteredItems.slice(startIndex, endIndex);

                // æ›´æ–°åˆ†é¡µä¿¡æ¯
                document.getElementById('currentPage').textContent = this.currentPage;
                document.getElementById('totalPages').textContent = this.totalPages;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.getElementById('prevBtn').disabled = this.currentPage === 1;
                document.getElementById('nextBtn').disabled = this.currentPage === this.totalPages;

                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';

                // æ¸²æŸ“é¡¹ç›®
                currentItems.forEach((item, index) => {
                    const itemElement = this.createGalleryItem(item, startIndex + index);
                    container.appendChild(itemElement);
                });

                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            createGalleryItem(item, index) {
                const div = document.createElement('div');
                div.className = 'gallery-item';
                div.addEventListener('click', () => this.openModal(item));

                const isVideo = item.type === 'video';
                const mediaElement = isVideo ? 'video' : 'img';
                const videoIndicator = isVideo ? '<div class="video-indicator">ğŸ¬ åŠ¨æ€</div>' : '';

                // ç”Ÿæˆæ ‡ç­¾
                const tags = this.generateTags(item);

                div.innerHTML = `
                    ${videoIndicator}
                    <${mediaElement} 
                        src="${item.url}" 
                        alt="${item.title}"
                        loading="lazy"
                        ${isVideo ? 'preload="metadata" muted' : ''}
                        onerror="this.parentElement.querySelector('.loading-placeholder').style.display='flex'; this.style.display='none';"
                    ></${mediaElement}>
                    <div class="loading-placeholder" style="display: none;">
                        åŠ è½½å¤±è´¥
                    </div>
                    <div class="item-info">
                        <div class="item-title">${item.title}</div>
                        <div class="item-tags">${tags}</div>
                    </div>
                `;

                // è§†é¢‘ç¼©ç•¥å›¾ç”Ÿæˆ
                if (isVideo) {
                    this.generateVideoThumbnail(div.querySelector('video'), div);
                }

                return div;
            }

            generateTags(item) {
                const tags = [];
                
                // åˆ†ç±»æ ‡ç­¾
                if (item.category) {
                    const categoryMap = {
                        'fantasy': 'å¥‡å¹»',
                        'desktop': 'æ¡Œé¢',
                        'mobile': 'æ‰‹æœº',
                        'seasonal': 'å­£èŠ‚',
                        '4k': '4K',
                        'live': 'åŠ¨æ€'
                    };
                    const categoryName = categoryMap[item.category] || item.category;
                    tags.push(`<span class="tag ${item.category}">${categoryName}</span>`);
                }

                // åˆ†è¾¨ç‡æ ‡ç­¾
                if (item.resolution && item.resolution !== item.category) {
                    tags.push(`<span class="tag k4">${item.resolution}</span>`);
                }

                return tags.join('');
            }

            generateVideoThumbnail(video, container) {
                video.addEventListener('loadeddata', () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    video.currentTime = 1; // è·å–ç¬¬1ç§’çš„å¸§
                    
                    video.addEventListener('seeked', () => {
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        
                        const img = document.createElement('img');
                        img.src = canvas.toDataURL();
                        img.alt = video.alt;
                        img.loading = 'lazy';
                        img.style.width = '100%';
                        img.style.height = 'auto';
                        img.style.display = 'block';
                        
                        video.style.display = 'none';
                        video.parentNode.insertBefore(img, video);
                    }, { once: true });
                });
            }

            openModal(item) {
                const modal = document.getElementById('imageModal');
                const modalImage = document.getElementById('modalImage');
                const modalVideo = document.getElementById('modalVideo');
                const modalTitle = document.getElementById('modalTitle');
                const modalTags = document.getElementById('modalTags');
                const downloadBtn = document.getElementById('downloadBtn');

                // è®¾ç½®å†…å®¹
                modalTitle.textContent = item.title;
                modalTags.innerHTML = this.generateTags(item);

                if (item.type === 'video') {
                    modalImage.style.display = 'none';
                    modalVideo.style.display = 'block';
                    modalVideo.src = item.url;
                } else {
                    modalVideo.style.display = 'none';
                    modalImage.style.display = 'block';
                    modalImage.src = item.url;
                }

                // ä¸‹è½½æŒ‰é’®
                downloadBtn.onclick = () => this.downloadFile(item.url, item.title);

                modal.style.display = 'block';
            }

            pauseModalVideo() {
                const modalVideo = document.getElementById('modalVideo');
                if (!modalVideo.paused) {
                    modalVideo.pause();
                }
            }

            downloadFile(url, filename) {
                const a = document.createElement('a');
                a.href = url;
                a.download = filename + '.' + url.split('.').pop();
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            hideLoading() {
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }

        // åˆå§‹åŒ–ç”»å»Š
        document.addEventListener('DOMContentLoaded', () => {
            new HDLabubuGallery();
        });
    </script>
</body>
</html>
