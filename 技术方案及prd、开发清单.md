# 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品名称
简易壁纸自定义工具（包含多个模板）

### 1.2 产品背景
本工具旨在提供一个简单易用的在线壁纸自定义平台，允许用户上传背景图像、添加自定义图层元素（文本、图形、图标等）、选择并应用多个模板（如手电筒、粒子等），最终生成 **PNG** 或 **GIF** 格式的壁纸。手电筒效果只是多个预设模板中的一种，用户可以选择它，也可以自由组合其他元素来自定义自己的壁纸。

### 1.3 目标用户
- 喜欢个性化壁纸的用户
- 想要快速制作静态或动态壁纸的用户
- 对简单动画（如手电筒、粒子等效果）感兴趣的用户
- 无需复杂工具的用户，寻求快速编辑和导出的功能

---

## 2. 功能需求

### 2.1 用户故事

1. **用户上传背景图像**：
   - 作为用户，我希望能够上传自己的图像文件，作为壁纸的背景。
   
2. **自定义图层元素**：
   - 作为用户，我希望能够在背景上添加文本、图形、图标等，调整它们的位置、大小、颜色等。
   
3. **选择并应用模板**：
   - 作为用户，我希望能够选择一个模板（例如：手电筒效果、粒子动画、光照效果等），使其在我的自定义壁纸中生效。
   
4. **设置动画效果（仅GIF格式）**：
   - 作为用户，我希望能够设置图层和模板的简单动画效果，例如移动、缩放、旋转等。
   
5. **实时预览效果**：
   - 作为用户，我希望能够实时预览我所做的修改和动画效果，确保最终效果符合我的需求。
   
6. **导出壁纸**：
   - 作为用户，我希望能够导出自定义的壁纸为 **PNG** 或 **GIF** 格式，便于保存或使用。

---

### 2.2 功能模块

1. **背景图像上传与调整**
   - **上传背景**：用户可以上传自己的图像文件，支持常见格式（如 `.jpg`, `.png`）。
   - **背景调整**：用户可以调整图像的裁剪、缩放、旋转等，使其适应壁纸尺寸。

2. **自定义图层元素**
   - **文本添加**：允许用户添加自定义文本，设置字体、颜色、大小、透明度和位置。
   - **图形/图标添加**：用户可以插入图形（例如圆形、矩形、线条等）和图标，调整它们的样式和位置。
   - **图层排序**：允许用户控制图层的前后顺序，确保元素按需求堆叠。

3. **模板选择与应用**
   - **预设模板**：提供多个预设模板（例如：手电筒效果、粒子动画等）。
   - **模板调整**：用户可以调整模板的参数，例如手电筒路径、光照强度、粒子速度等。

4. **简单动画设置（仅GIF格式）**
   - **动画类型**：支持设置文本、图形和背景的简单动画，如平移、缩放、旋转、透明度渐变等。
   - **帧数控制**：用户可以设置动画的持续时间、帧数和动画速度，调整 GIF 动画的质量和大小。

5. **实时预览**
   - 提供一个实时预览窗口，显示当前编辑的效果。每次调整或选择模板时，预览窗口都会更新，用户能够看到手电筒等模板效果。

6. **导出功能**
   - **导出为 PNG**：用户可以生成静态壁纸，输出为 **PNG** 格式。
   - **导出为 GIF**：生成带有动画效果的壁纸，输出为 **GIF** 格式，支持用户选择帧数、持续时间等参数。

7. **撤销与重做功能**
   - 允许用户撤销或重做每一步操作，例如图层调整、动画设置等。

---

# 技术方案 & 开发清单

## 1. 项目概述

### 1.1 项目目标
开发一个壁纸自定义工具，支持用户上传背景图像、添加自定义图层元素（文本、图形、图标等）、选择并应用多个模板（如手电筒、粒子等），最终导出静态 **PNG** 或动态 **GIF** 格式的壁纸。

### 1.2 核心功能
1. 用户上传并编辑背景图像。
2. 用户添加文本、图形和图标等元素。
3. 用户选择并应用模板（如手电筒、粒子等效果）。
4. 实时预览用户的修改效果。
5. 用户导出为 PNG 或 GIF 格式。

---

## 2. 前端技术实现

### 2.1 技术栈
- **React**：构建动态界面，处理用户交互。
- **Next.js**：用于服务器端渲染（SSR），提高性能和SEO优化。
- **Canvas/WebGL**：在浏览器中渲染图像、文本、图形以及动态效果（如手电筒、粒子等）。
- **gif.js**：用于生成 GIF 动画，将用户的编辑过程转化为 GIF 格式。
- **CSS**：响应式布局，确保界面适配不同屏幕尺寸。

### 2.2 功能模块与开发任务

#### 2.2.1 背景上传与编辑
- **开发任务**：
  1. 提供文件选择按钮，允许用户上传背景图像（`.jpg`, `.png`）。
  2. 使用 Canvas 渲染背景图像，支持裁剪、缩放、旋转等基本操作。
  3. 背景图像调整工具的 UI 开发，允许用户控制缩放、裁剪等参数。

#### 2.2.2 图层元素自定义
- **开发任务**：
  1. 用户能够添加文本、图形（如矩形、圆形）或图标。
  2. 为每个图层元素提供编辑功能，包括：字体、颜色、大小、透明度、位置、旋转等。
  3. 实现图层排序功能，允许用户调整元素的前后顺序。
  4. 图层元素添加和编辑的 UI 开发。

#### 2.2.3 模板选择与应用
- **开发任务**：
  1. 提供多个预设模板（如手电筒效果、粒子动画等）。
  2. 为每个模板提供可调参数，例如手电筒的路径、粒子的速度等。
  3. 使用 Canvas 动态渲染模板效果。

#### 2.2.4 动画效果（仅GIF格式）
- **开发任务**：
  1. 实现简单的动画功能，支持平移、缩放、旋转、透明度渐变等。
  2. 提供动画帧数和持续时间设置，控制 GIF 动画的速度。
  3. 使用 `gif.js` 库生成动态 GIF 图像。
  4. 实时预览动画效果。

#### 2.2.5 实时预览
- **开发任务**：
  1. 开发一个实时预览窗口，显示当前用户的修改效果。
  2. 当用户更改元素位置、选择模板或添加动画时，实时更新预览。

#### 2.2.6 导出功能
- **开发任务**：
  1. 提供导出为 PNG 格式的功能，导出当前的壁纸为静态图片。
  2. 提供导出为 GIF 格式的功能，允许用户选择帧率、动画持续时间等参数。
  3. 使用 Canvas API 或 **gifencoder** 库来生成 PNG 和 GIF 文件。
  4. 生成的文件可以通过链接下载，或通过弹窗提示下载成功。

#### 2.2.7 撤销与重做功能
- **开发任务**：
  1. 使用 **React** 状态管理，保持操作历史。
  2. 实现撤销（Undo）和重做（Redo）功能，允许用户回退或重新执行操作。

---

## 3. 后端技术实现

### 3.1 技术栈
- **Node.js**：后端服务器，处理文件上传、图像生成和文件导出。
- **sharp**：图像处理库，处理上传的背景图像的裁剪、缩放等操作。
- **gifencoder**：将多个图像帧生成 GIF 动画。
- **Cloud Storage**：用于存储用户上传的图像和生成的壁纸文件（例如：AWS S3、Google Cloud Storage）。
- **Express.js**：处理前端请求，提供文件上传和导出接口。

### 3.2 功能模块与开发任务

#### 3.2.1 文件上传处理
- **开发任务**：
  1. 设置文件上传接口，支持背景图像、图层元素（如图标）等文件的上传。
  2. 使用 `multer` 或 `formidable` 等库进行文件上传处理。
  3. 将上传的文件存储在云存储或本地服务器中。

#### 3.2.2 图像处理
- **开发任务**：
  1. 使用 **sharp** 库进行图像裁剪、缩放等处理，确保图像适应壁纸尺寸。
  2. 根据用户的操作调整图像大小、旋转和裁剪。
  3. 处理背景图和自定义元素图像的组合，输出最终图像。

#### 3.2.3 GIF 动画生成
- **开发任务**：
  1. 使用 **gifencoder** 库将多帧图像合成 GIF 动画。
  2. 设置 GIF 的帧率、持续时间等参数，确保动画流畅。
  3. 将生成的 GIF 文件存储在服务器或云存储中，并提供下载链接。

#### 3.2.4 导出接口
- **开发任务**：
  1. 创建导出接口，支持将处理后的图像导出为 PNG 或 GIF 格式。
  2. 提供接口下载生成的壁纸文件。

---

## 4. 开发清单

### 4.1 前端开发清单
1. 设置 React 项目基础结构，配置 Webpack 和 Babel。
2. 开发背景图上传模块，并集成到 Canvas 渲染中。
3. 开发文本、图形和图标元素添加与编辑模块。
4. 开发模板选择与应用功能，支持手电筒、粒子等效果。
5. 开发动画设置功能，支持平移、缩放、旋转等效果。
6. 实现实时预览窗口，实时展示修改效果。
7. 集成 GIF 动画生成库，支持用户导出 GIF 文件。
8. 完成导出功能，支持 PNG 和 GIF 格式下载。
9. 实现撤销和重做功能，管理用户操作历史。

### 4.2 后端开发清单
1. 配置 Node.js 项目，安装 Express.js 和其他依赖。
2. 设置文件上传接口，支持多种图像格式上传。
3. 实现图像处理模块，支持图像裁剪、缩放、合成等。
4. 集成 gifencoder 库，支持生成 GIF 动画。
5. 创建导出接口，允许前端请求导出 PNG 或 GIF 文件。
6. 将图像和生成的壁纸文件存储在云存储（如 AWS S3）中。
7. 完成文件下载接口，提供生成壁纸的下载链接。

---

## 5. 项目时间估算

| **模块**              | **开发时间**  | **备注**                   |
|----------------------|--------------|----------------------------|
| **前端开发**          | 3-4 周        | 包括上传、编辑、预览等功能  |
| **后端开发**          | 3-4 周        | 包括文件上传、图像处理等    |
| **GIF 动画功能**      | 2 周          | 生成 GIF 动画               |
| **实时预览与导出**    | 2 周          | 导出功能和实时预览功能      |
| **用户体验优化**      | 1-2 周        | 包括 UI 改进、性能优化等    |
| **测试与调试**        | 1-2 周        | 功能测试、Bug 修复          |

---

## 6. 技术风险与挑战

- **性能问题**：生成 GIF 动画可能会涉及大量的图像处理，可能导致性能瓶颈，尤其是在低端设备或高分辨率图像时。需要优化帧数、图像压缩等。
- **复杂图层管理**：图层之间的关系和顺序管理需要细致的状态管理，以避免出现图层显示错误或排版问题。
- **浏览器兼容性**：不同浏览器对 Canvas 和 WebGL 的支持不同，可能需要做一些兼容性调整。
