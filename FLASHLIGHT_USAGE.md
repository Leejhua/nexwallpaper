# 🔦 Labubu Flashlight Editor 使用指南

## 快速开始

### 1. 启动开发环境
```bash
# 方式A: 同时启动前端和API服务器
npm run dev:full

# 方式B: 分别启动（两个终端）
# 终端1: 启动API服务器 (端口3001)
npm run dev:api

# 终端2: 启动前端 (端口5173)
npm run dev -- --port 5173
```

### 2. 访问测试页面
在浏览器中打开：`http://localhost:5173/flashlight-test.html`

## 使用步骤

### Step 1: 上传图片 📷
- 点击左侧 "选择图片" 区域
- 支持格式：JPG, PNG, WebP
- 建议使用清晰、适中尺寸的图片

### Step 2: 调整图片 🎛️
- **缩放**: 使用滑块或 +/- 按钮调整大小
- **旋转**: 点击 ↺ ↻ 按钮旋转 15° 
- **拖拽**: 在右侧预览区域拖拽图片位置
- **重置**: 点击 "重置位置" 恢复初始状态

### Step 3: 生成遮罩 🎭
- 点击 "生成遮罩" 按钮
- 系统会自动：
  - 分析视频中的手电筒光束区域
  - 生成扇形多边形遮罩
  - 在右侧显示实时预览效果

### Step 4: 导出视频 📥
- 点击 "导出视频" 按钮
- 后端会：
  - 将您的图片叠加到视频最后几帧
  - 生成新的 MP4 文件
  - 自动下载到您的设备

## 技术特性

- ✅ **智能检测**: 使用 OpenCV.js 自动识别光束形状
- ✅ **实时预览**: Canvas 渲染即时显示效果
- ✅ **精确控制**: 支持拖拽、缩放、旋转操作
- ✅ **高质量输出**: 保持原视频质量和帧率
- ✅ **错误处理**: 完善的错误提示和降级策略

## 故障排除

### 常见问题

**Q: 页面加载很慢**
A: ffmpeg.wasm 和 OpenCV.js 首次加载较大，请耐心等待

**Q: 生成遮罩失败**
A: 检查网络连接，确保能访问 CDN 资源

**Q: 导出视频失败 (404错误)**
A: 确保 API 服务器已启动：`npm run dev:api`，应看到端口 3001 的输出

**Q: 导出视频失败 (500错误)**  
A: 检查系统是否安装 ffmpeg：`which ffmpeg`，或查看 API 服务器日志

**Q: 预览效果不理想**
A: 尝试调整图片大小和位置，确保在绿色光束轮廓内

### 控制台日志
打开浏览器开发者工具（F12），查看：
- ffmpeg.wasm 加载进度
- OpenCV.js 初始化状态  
- 光束检测结果
- API 请求响应

## 开发说明

- **前端**: React + Canvas + ffmpeg.wasm + OpenCV.js
- **后端**: Next.js API Route + ffmpeg-static
- **输出**: MP4 (未来可扩展 HEIF)

当前版本为 MVP，专注核心功能验证。 