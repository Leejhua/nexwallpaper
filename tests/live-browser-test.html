<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶æµè§ˆå™¨æµ‹è¯•éªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .test-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 6px;
            border-left: 4px solid #28a745;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .results.error {
            border-left-color: #dc3545;
        }
        
        .device-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        
        .progress {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å®æ—¶æµè§ˆå™¨æµ‹è¯•éªŒè¯</h1>
        
        <!-- è®¾å¤‡ä¿¡æ¯ -->
        <div class="device-info">
            <h3>ğŸ“± å½“å‰ç¯å¢ƒä¿¡æ¯</h3>
            <div id="device-info"></div>
        </div>
        
        <!-- æµ‹è¯•è„šæœ¬åŠ è½½éªŒè¯ -->
        <div class="test-section">
            <h3>ğŸ“¦ æµ‹è¯•è„šæœ¬åŠ è½½éªŒè¯</h3>
            <p>éªŒè¯æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£ç¡®åŠ è½½åˆ°æµè§ˆå™¨ç¯å¢ƒä¸­</p>
            <button class="test-button" onclick="validateScriptLoading()">éªŒè¯è„šæœ¬åŠ è½½</button>
            <div class="progress"><div class="progress-bar" id="script-progress"></div></div>
            <div id="script-results" class="results" style="display: none;"></div>
        </div>
        
        <!-- åŠŸèƒ½æµ‹è¯•éªŒè¯ -->
        <div class="test-section">
            <h3>ğŸ”§ åŠŸèƒ½æµ‹è¯•éªŒè¯</h3>
            <p>éªŒè¯æµ‹è¯•å‡½æ•°æ˜¯å¦èƒ½æ­£å¸¸æ‰§è¡Œ</p>
            <button class="test-button" onclick="validateFunctionality()">éªŒè¯åŠŸèƒ½æµ‹è¯•</button>
            <div class="progress"><div class="progress-bar" id="function-progress"></div></div>
            <div id="function-results" class="results" style="display: none;"></div>
        </div>
        
        <!-- å®é™…æµ‹è¯•è¿è¡Œ -->
        <div class="test-section">
            <h3>ğŸš€ å®é™…æµ‹è¯•è¿è¡Œ</h3>
            <p>è¿è¡Œå®é™…çš„æµ‹è¯•å¥—ä»¶å¹¶æŸ¥çœ‹ç»“æœ</p>
            <button class="test-button" onclick="runActualTests()">è¿è¡Œå®é™…æµ‹è¯•</button>
            <div class="progress"><div class="progress-bar" id="actual-progress"></div></div>
            <div id="actual-results" class="results" style="display: none;"></div>
        </div>
        
        <!-- ä¸»åº”ç”¨è¿æ¥æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸŒ ä¸»åº”ç”¨è¿æ¥æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¸ä¸»åº”ç”¨çš„è¿æ¥å’Œäº¤äº’</p>
            <button class="test-button" onclick="testMainAppConnection()">æµ‹è¯•ä¸»åº”ç”¨è¿æ¥</button>
            <button class="test-button" onclick="openMainAppForTesting()">æ‰“å¼€ä¸»åº”ç”¨æµ‹è¯•</button>
            <div id="connection-results" class="results" style="display: none;"></div>
        </div>
    </div>

    <!-- åŠ è½½æµ‹è¯•è„šæœ¬ -->
    <script src="desktop-mobile-test.js"></script>
    <script src="desktop-specific-test.js"></script>
    <script src="mobile-specific-test.js"></script>
    
    <script>
        // åˆå§‹åŒ–è®¾å¤‡ä¿¡æ¯
        function initDeviceInfo() {
            const deviceInfo = document.getElementById('device-info');
            const isMobile = window.innerWidth <= 768;
            const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            const isDesktop = window.innerWidth > 1024;
            
            deviceInfo.innerHTML = `
                <div><strong>è®¾å¤‡ç±»å‹:</strong> ${isMobile ? 'ğŸ“± ç§»åŠ¨ç«¯' : isTablet ? 'ğŸ“Ÿ å¹³æ¿ç«¯' : 'ğŸ–¥ï¸ æ¡Œé¢ç«¯'}</div>
                <div><strong>å±å¹•å°ºå¯¸:</strong> ${window.innerWidth} Ã— ${window.innerHeight}</div>
                <div><strong>åƒç´ æ¯”:</strong> ${window.devicePixelRatio || 1}</div>
                <div><strong>æµè§ˆå™¨:</strong> ${getBrowserName()}</div>
                <div><strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent.substring(0, 80)}...</div>
                <div><strong>æ”¯æŒè§¦æ‘¸:</strong> ${'ontouchstart' in window ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>
                <div><strong>æœ¬åœ°å­˜å‚¨:</strong> ${typeof Storage !== 'undefined' ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</div>
            `;
        }
        
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'Unknown';
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(progressId, percentage) {
            const progressBar = document.getElementById(progressId);
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResults(resultsId, content, isError = false) {
            const resultsDiv = document.getElementById(resultsId);
            resultsDiv.style.display = 'block';
            resultsDiv.className = `results ${isError ? 'error' : ''}`;
            resultsDiv.innerHTML = content;
        }
        
        // éªŒè¯è„šæœ¬åŠ è½½
        async function validateScriptLoading() {
            updateProgress('script-progress', 0);
            let results = 'ğŸ” å¼€å§‹éªŒè¯æµ‹è¯•è„šæœ¬åŠ è½½...\n\n';
            
            const scriptsToCheck = [
                { name: 'ResponsiveTestRunner', description: 'ç»¼åˆæµ‹è¯•' },
                { name: 'DesktopTestRunner', description: 'æ¡Œé¢ç«¯æµ‹è¯•' },
                { name: 'MobileTestRunner', description: 'ç§»åŠ¨ç«¯æµ‹è¯•' }
            ];
            
            let loadedCount = 0;
            
            for (let i = 0; i < scriptsToCheck.length; i++) {
                const script = scriptsToCheck[i];
                const isLoaded = typeof window[script.name] !== 'undefined';
                const status = isLoaded ? 'âœ…' : 'âŒ';
                
                results += `${status} ${script.name} (${script.description}): ${isLoaded ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}\n`;
                
                if (isLoaded) {
                    loadedCount++;
                    
                    // æ£€æŸ¥å…³é”®æ–¹æ³•
                    try {
                        const instance = new window[script.name]();
                        const hasRunMethod = typeof instance.runAllTests === 'function';
                        const hasLogMethod = typeof instance.logResult === 'function';
                        
                        results += `  â””â”€ runAllTestsæ–¹æ³•: ${hasRunMethod ? 'âœ…' : 'âŒ'}\n`;
                        results += `  â””â”€ logResultæ–¹æ³•: ${hasLogMethod ? 'âœ…' : 'âŒ'}\n`;
                    } catch (error) {
                        results += `  â””â”€ å®ä¾‹åŒ–å¤±è´¥: ${error.message}\n`;
                    }
                }
                
                updateProgress('script-progress', ((i + 1) / scriptsToCheck.length) * 100);
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            const loadRate = (loadedCount / scriptsToCheck.length * 100).toFixed(1);
            results += `\nğŸ“Š è„šæœ¬åŠ è½½ç‡: ${loadedCount}/${scriptsToCheck.length} (${loadRate}%)\n`;
            results += `çŠ¶æ€: ${loadRate >= 66.7 ? 'âœ… è‰¯å¥½' : 'âš ï¸ éœ€è¦æ£€æŸ¥'}`;
            
            showResults('script-results', results, loadRate < 66.7);
        }
        
        // éªŒè¯åŠŸèƒ½æµ‹è¯•
        async function validateFunctionality() {
            updateProgress('function-progress', 0);
            let results = 'ğŸ”§ å¼€å§‹éªŒè¯åŠŸèƒ½æµ‹è¯•...\n\n';
            
            const functionsToCheck = [
                'runResponsiveTests',
                'runDesktopTests', 
                'runMobileTests'
            ];
            
            let workingCount = 0;
            
            for (let i = 0; i < functionsToCheck.length; i++) {
                const funcName = functionsToCheck[i];
                const exists = typeof window[funcName] === 'function';
                const status = exists ? 'âœ…' : 'âŒ';
                
                results += `${status} ${funcName}: ${exists ? 'å‡½æ•°å­˜åœ¨' : 'å‡½æ•°ä¸å­˜åœ¨'}\n`;
                
                if (exists) {
                    workingCount++;
                }
                
                updateProgress('function-progress', ((i + 1) / functionsToCheck.length) * 100);
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            const workRate = (workingCount / functionsToCheck.length * 100).toFixed(1);
            results += `\nğŸ“Š åŠŸèƒ½å¯ç”¨ç‡: ${workingCount}/${functionsToCheck.length} (${workRate}%)\n`;
            results += `çŠ¶æ€: ${workRate >= 66.7 ? 'âœ… è‰¯å¥½' : 'âš ï¸ éœ€è¦æ£€æŸ¥'}`;
            
            showResults('function-results', results, workRate < 66.7);
        }
        
        // è¿è¡Œå®é™…æµ‹è¯•
        async function runActualTests() {
            updateProgress('actual-progress', 0);
            let results = 'ğŸš€ å¼€å§‹è¿è¡Œå®é™…æµ‹è¯•...\n\n';
            
            const isMobile = window.innerWidth <= 768;
            const testType = isMobile ? 'mobile' : 'desktop';
            
            results += `æ£€æµ‹åˆ°${isMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯'}ç¯å¢ƒï¼Œè¿è¡Œå¯¹åº”æµ‹è¯•...\n\n`;
            
            try {
                if (isMobile && typeof runMobileTests === 'function') {
                    results += 'ğŸ“± è¿è¡Œç§»åŠ¨ç«¯æµ‹è¯•...\n';
                    updateProgress('actual-progress', 30);
                    
                    // æ•è·æ§åˆ¶å°è¾“å‡º
                    const originalLog = console.log;
                    let testOutput = '';
                    console.log = (...args) => {
                        testOutput += args.join(' ') + '\n';
                        originalLog(...args);
                    };
                    
                    await runMobileTests();
                    console.log = originalLog;
                    
                    results += testOutput || 'æµ‹è¯•å·²è¿è¡Œï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ç»“æœ\n';
                    updateProgress('actual-progress', 100);
                    
                } else if (!isMobile && typeof runDesktopTests === 'function') {
                    results += 'ğŸ–¥ï¸ è¿è¡Œæ¡Œé¢ç«¯æµ‹è¯•...\n';
                    updateProgress('actual-progress', 30);
                    
                    // æ•è·æ§åˆ¶å°è¾“å‡º
                    const originalLog = console.log;
                    let testOutput = '';
                    console.log = (...args) => {
                        testOutput += args.join(' ') + '\n';
                        originalLog(...args);
                    };
                    
                    await runDesktopTests();
                    console.log = originalLog;
                    
                    results += testOutput || 'æµ‹è¯•å·²è¿è¡Œï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ç»“æœ\n';
                    updateProgress('actual-progress', 100);
                    
                } else {
                    results += 'âŒ å¯¹åº”çš„æµ‹è¯•å‡½æ•°ä¸å¯ç”¨\n';
                    results += 'è¯·æ£€æŸ¥æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£ç¡®åŠ è½½\n';
                    updateProgress('actual-progress', 100);
                }
                
                results += '\nâœ… å®é™…æµ‹è¯•è¿è¡Œå®Œæˆ\n';
                results += 'ğŸ’¡ æç¤º: æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·(F12)æŸ¥çœ‹è¯¦ç»†æµ‹è¯•ç»“æœ';
                
            } catch (error) {
                results += `âŒ æµ‹è¯•è¿è¡Œå¤±è´¥: ${error.message}\n`;
                updateProgress('actual-progress', 100);
            }
            
            showResults('actual-results', results);
        }
        
        // æµ‹è¯•ä¸»åº”ç”¨è¿æ¥
        async function testMainAppConnection() {
            let results = 'ğŸŒ æµ‹è¯•ä¸»åº”ç”¨è¿æ¥...\n\n';
            
            try {
                const response = await fetch('http://localhost:3000');
                const isOk = response.ok;
                
                results += `${isOk ? 'âœ…' : 'âŒ'} æœåŠ¡å™¨è¿æ¥: HTTP ${response.status}\n`;
                results += `${isOk ? 'âœ…' : 'âŒ'} å†…å®¹ç±»å‹: ${response.headers.get('content-type')}\n`;
                
                if (isOk) {
                    results += 'âœ… ä¸»åº”ç”¨æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ\n';
                    results += 'âœ… å¯ä»¥è¿›è¡Œå®é™…æµ‹è¯•\n';
                } else {
                    results += 'âŒ ä¸»åº”ç”¨æœåŠ¡å™¨å¼‚å¸¸\n';
                    results += 'âš ï¸ è¯·æ£€æŸ¥å¼€å‘æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨\n';
                }
                
            } catch (error) {
                results += `âŒ è¿æ¥å¤±è´¥: ${error.message}\n`;
                results += 'âš ï¸ è¯·ç¡®ä¿å¼€å‘æœåŠ¡å™¨åœ¨ http://localhost:3000 è¿è¡Œ\n';
            }
            
            showResults('connection-results', results);
        }
        
        // æ‰“å¼€ä¸»åº”ç”¨è¿›è¡Œæµ‹è¯•
        function openMainAppForTesting() {
            const mainWindow = window.open('http://localhost:3000', '_blank');
            
            setTimeout(() => {
                if (mainWindow) {
                    alert('ğŸ¯ ä¸»åº”ç”¨å·²æ‰“å¼€ï¼\n\n' +
                          'è¯·åœ¨æ–°çª—å£ä¸­ï¼š\n' +
                          '1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·\n' +
                          '2. åˆ‡æ¢åˆ° Console æ ‡ç­¾\n' +
                          '3. è¿è¡Œä»¥ä¸‹æµ‹è¯•å‘½ä»¤ï¼š\n\n' +
                          'â€¢ runDesktopTests()    - æ¡Œé¢ç«¯æµ‹è¯•\n' +
                          'â€¢ runMobileTests()     - ç§»åŠ¨ç«¯æµ‹è¯•\n' +
                          'â€¢ runResponsiveTests() - ç»¼åˆæµ‹è¯•\n\n' +
                          'æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­ã€‚');
                } else {
                    alert('âŒ æ— æ³•æ‰“å¼€ä¸»åº”ç”¨çª—å£\nè¯·æ‰‹åŠ¨è®¿é—®: http://localhost:3000');
                }
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initDeviceInfo();
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', initDeviceInfo);
            
            console.log('ğŸ§ª å®æ—¶æµè§ˆå™¨æµ‹è¯•éªŒè¯é¡µé¢å·²åŠ è½½');
            console.log('ğŸ’¡ æ‚¨å¯ä»¥ç‚¹å‡»æŒ‰é’®è¿›è¡Œå„é¡¹éªŒè¯æµ‹è¯•');
        });
    </script>
</body>
</html>
