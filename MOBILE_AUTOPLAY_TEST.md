# 移动端视频自动播放功能测试

## 🎯 功能目标
在移动端中，视频卡片移动到主视角时自动播放，离开主视角时自动暂停，提升移动端用户体验。

## 🆕 新功能特性

### 1. 智能播放策略
- **📱 移动端**：基于视窗检测（Intersection Observer）
  - 视频卡片60%进入主视角 → 自动播放
  - 视频卡片离开主视角 → 自动暂停
- **🖥️ 桌面端**：保持原有hover播放行为
  - 鼠标悬停 → 播放
  - 鼠标离开 → 暂停

### 2. 视窗检测配置
```javascript
threshold: 0.6,                    // 60%进入视窗时触发
rootMargin: '-10% 0px -10% 0px'   // 上下留10%边距，确保在主视角
```

### 3. 新增调试功能
- 视窗检测状态日志
- 播放策略决策日志
- 设备类型识别日志

## 🛠️ 技术实现

### 新增Hook (`src/hooks/useIntersectionObserver.js`)
- `useIntersectionObserver`: 基础视窗检测
- `useVideoAutoPlay`: 视频自动播放控制系统

### 修改组件 (`src/components/GalleryItem.jsx`)
- 集成新的视频自动播放Hook
- 统一容器ref管理（图片预加载 + 视频自动播放）
- 简化移动端触摸事件处理

## 📋 测试步骤

### 测试环境要求
- 移动设备或桌面浏览器移动端模拟
- Chrome/Safari等支持Intersection Observer的浏览器
- 开发者工具控制台开启

### 移动端测试

#### 测试1：基础自动播放
1. 在移动设备或浏览器移动端模式下访问网站
2. 滚动到包含视频的区域
3. **期望行为**：
   - 视频卡片进入主视角时自动开始播放
   - 播放状态指示器显示（红色"LIVE"标签）
   - 控制台显示：`📱 ID XX 移动端播放策略: 自动播放`

#### 测试2：离开视角暂停
1. 继续滚动，让视频卡片离开主视角
2. **期望行为**：
   - 视频自动暂停
   - 播放状态指示器消失
   - 控制台显示：`📱 ID XX 移动端播放策略: 暂停`

#### 测试3：多视频同时处理
1. 快速滚动经过多个视频卡片
2. **期望行为**：
   - 只有在主视角的视频播放
   - 离开视角的视频自动暂停
   - 性能良好，无卡顿

#### 测试4：问题视频降级
1. 滚动到ID 85、100等已知问题视频
2. **期望行为**：
   - 视频URL加载失败时显示预览图
   - 预览图仍然响应视窗检测
   - 控制台显示降级URL尝试信息

### 桌面端测试

#### 测试5：保持hover行为
1. 在桌面浏览器中访问网站
2. 鼠标悬停在视频卡片上
3. **期望行为**：
   - 悬停时视频播放
   - 离开时视频暂停
   - 控制台显示：`🖥️ ID XX 桌面端播放策略: hover播放`

### 调试信息测试

#### 测试6：控制台日志验证
期望看到以下类型的日志信息：

**视窗检测日志**：
```
📱 视窗检测 ID 85: 进入视窗
📱 ID 85 移动端播放策略: 自动播放
▶️ 视频 ID 85 开始播放
```

**设备切换日志**：
```
🖥️ ID 85 桌面端播放策略: hover播放
📱 ID 85 移动端播放策略: 自动播放
```

**播放状态日志**：
```
▶️ 视频 ID 85 开始播放
⏸️ 视频 ID 85 暂停播放
```

## 🎮 用户体验改进

### 移动端体验
- ✅ **无需手动操作**：视频进入视角自动播放
- ✅ **省电优化**：离开视角自动暂停
- ✅ **网络友好**：只播放可见视频，节省流量
- ✅ **性能优化**：intelligent预加载策略

### 兼容性保证
- ✅ **桌面端无影响**：保持原有hover播放行为
- ✅ **降级处理**：不支持自动播放时显示预览图
- ✅ **错误恢复**：播放失败时优雅降级

## 🔧 配置参数

### 视窗检测灵敏度
```javascript
threshold: 0.6,  // 可调整为0.3-0.8，影响播放触发时机
rootMargin: '-10% 0px -10% 0px'  // 可调整边距，影响"主视角"定义
```

### 播放策略
```javascript
// 问题视频使用保守策略
preload="metadata"  // 仅预加载元数据

// 正常视频使用标准策略  
preload="auto"      // 标准预加载
```

## ⚠️ 注意事项

1. **浏览器兼容性**：需要支持Intersection Observer API
2. **自动播放限制**：某些浏览器可能阻止自动播放
3. **性能考虑**：大量视频同时在视窗内可能影响性能
4. **网络环境**：弱网环境下建议调整threshold值

## 🚀 后续优化方向

1. **智能预加载**：根据滚动方向预测用户行为
2. **网络自适应**：根据网速调整播放策略
3. **电量感知**：低电量时禁用自动播放
4. **用户偏好**：提供自动播放开关设置

## ✅ 验收标准
- [x] 移动端视频进入主视角自动播放
- [x] 移动端视频离开主视角自动暂停  
- [x] 桌面端保持原有hover播放行为
- [x] 控制台提供详细调试信息
- [x] 支持问题视频的降级处理
- [x] 性能良好，无明显卡顿 