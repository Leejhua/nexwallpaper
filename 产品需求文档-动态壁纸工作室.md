# 技术方案：Labubu 手电筒效果 + GIF 动画输出

## 1. 功能概述

### 1.1 目标
开发一个简单的壁纸自定义工具，允许用户上传背景图像，选择 **手电筒光照效果**（Labubu 模板）并生成 **GIF 动画**。用户能够：
- 上传背景图像。
- 设置手电筒效果，模拟光照扫过黑暗背景。
- 在光照区域展示目标图像（如用户上传的图像或文本）。
- 导出最终效果为 **GIF 动画**。

### 1.2 功能模块
1. 背景图像上传与调整。
2. 手电筒光照模板应用。
3. 图像或文本的动态展示。
4. GIF 动画生成与导出。

---

## 2. 核心技术架构

### 2.1 前端技术栈
- **React**：构建交互式 UI，处理实时预览和用户输入。
- **Next.js**：用于服务器端渲染（SSR），优化性能和 SEO。
- **Canvas/WebGL**：用来渲染手电筒效果、遮罩层、背景图像等。
- **gif.js**：生成 GIF 动画，将 Canvas 渲染的每一帧转换为 GIF。
- **CSS**：响应式布局，确保界面适配不同屏幕尺寸。

### 2.2 后端技术栈
- **Node.js**：处理文件上传、GIF 动画生成等后端功能。
- **sharp**：图像处理库，用于图像裁剪、缩放等。
- **gifencoder**：用于将多个图像帧生成 GIF 动画。
- **Cloud Storage**：存储上传的背景图像和生成的 GIF 文件（例如 AWS S3）。

---

## 3. 功能模块设计

### 3.1 背景图像上传与编辑
- **功能**：
  1. 用户上传背景图像，支持常见格式（`JPG`, `PNG`）。
  2. 支持背景图像的裁剪、缩放与旋转，适应固定尺寸（如 1080x1920）。
  
- **开发任务**：
  1. 提供文件上传接口。
  2. 使用 **Canvas** 渲染背景图像，并允许用户调整图像位置、尺寸。
  
### 3.2 手电筒光照模板
- **功能**：
  1. 黑色遮罩层覆盖整个背景。
  2. 创建一个可调节大小的手电筒光照圆圈，用户可以设置其路径和动画效果。
  3. 光照区域内显示用户上传的目标图像（如用户上传的图像或文本）。

- **开发任务**：
  1. 设计 Canvas 上的黑色遮罩层，模拟背景的“黑暗”状态。
  2. 使用 Canvas 绘制光照区域，模拟手电筒光斑，并设置光照路径（例如直线、曲线）。
  3. 用户可调整光照的强度、大小、移动速度等参数。
  4. 在光照区域内逐步展示目标图像或文本，创建动态效果。

### 3.3 GIF 动画生成与导出
- **功能**：
  1. 动画帧生成：逐帧渲染光照效果，记录每一帧的状态（手电筒位置、光照强度等）。
  2. 使用 **gif.js** 库将渲染帧转换为 GIF 动画。
  3. 用户可以设置 GIF 动画的持续时间和帧率。

- **开发任务**：
  1. 使用 **gif.js** 库进行动画帧的捕捉和转换，导出为 GIF 文件。
  2. 提供 GIF 动画设置：如帧率（FPS）、动画时长、循环次数等。
  3. 生成 GIF 文件后，提供下载链接。

### 3.4 实时预览
- **功能**：
  1. 在用户调整手电筒效果、光照路径和目标图像时，实时更新预览窗口。
  2. 预览窗口动态展示手电筒光照效果及目标图像的出现。

- **开发任务**：
  1. 使用 **Canvas** 实现实时渲染和更新。
  2. 实时播放每一帧，用户可以看到光照效果如何逐渐展现目标图像。

---

## 4. 开发清单

### 4.1 前端开发清单
1. **项目结构与初始化**：
   - 设置 React 项目和 Next.js 配置。
   - 使用 TailwindCSS 或 Material UI 快速构建响应式界面。

2. **背景图上传与调整**：
   - 提供背景图上传功能。
   - 使用 Canvas 渲染图像并允许用户调整尺寸、裁剪。

3. **手电筒光照效果**：
   - 使用 Canvas 绘制黑色遮罩层并动态创建光照区域。
   - 用户调整光照区域大小、路径和速度。
   - 在光照区域内逐步显示目标图像或文本。

4. **实时预览功能**：
   - 实现一个预览窗口，展示用户实时调整的效果。
   - 实时播放每一帧，用户可以看到光照效果如何逐渐展现目标图像。

5. **GIF 导出功能**：
   - 集成 **gif.js** 库，捕捉每一帧并生成 GIF 动画。
   - 允许用户设置动画时长、帧率等参数。
   - 提供生成后的 GIF 文件下载链接。

### 4.2 后端开发清单
1. **文件上传处理**：
   - 设置 **Node.js** 文件上传接口，支持多种图像格式上传。
   - 存储文件到云存储或本地文件系统。

2. **图像处理**：
   - 使用 **sharp** 处理上传的背景图像，确保图像适配壁纸尺寸。

3. **GIF 动画生成**：
   - 使用 **gifencoder** 或 **gif.js** 库生成 GIF 动画。
   - 控制动画的帧数、帧率、动画时长等，优化生成的 GIF 文件大小。

4. **导出接口**：
   - 提供导出功能，将处理后的图像或生成的 GIF 动画文件提供下载。

---

## 5. 项目时间估算

| **模块**              | **开发时间**  | **备注**                   |
|----------------------|--------------|----------------------------|
| **前端开发**          | 3-4 周        | 包括上传、编辑、预览等功能  |
| **后端开发**          | 2-3 周        | 文件上传、GIF 动画生成等    |
| **实时预览与导出功能**| 1-2 周        | 导出功能和实时预览功能      |
| **用户体验优化**      | 1-2 周        | 包括 UI 改进、性能优化等    |
| **测试与调试**        | 1 周          | 功能测试、Bug 修复          |

---

## 6. 技术风险与挑战

| **问题**               | **应对策略**                                             |
|----------------------|------------------------------------------------------|
| **性能瓶颈**           | 限制 GIF 帧数、控制图像大小，减少每帧的计算量                          |
| **光照路径平滑性**      | 使用平滑的贝塞尔曲线或路径插值算法来确保手电筒光照路径的平滑过渡             |
| **GIF 动画质量**        | 优化帧率和帧数，避免过高的图像质量导致 GIF 文件过大，使用 GIF 压缩技术              |
| **跨浏览器兼容性**      | 使用 polyfill 或 Canvas 降级渲染，确保在不同浏览器上的一致性                       |
